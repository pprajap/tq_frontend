# Use a custom Qt6 WASM image as the base image
FROM stateoftheartio/qt6:6.6-wasm-aqt

# Switch to the root user
USER root

# Set the working directory inside the container
WORKDIR /home/user/project

# copy the project files into the container
COPY . /home/user/project

# Create the build directory, configure the project with CMake, and build it using Ninja
RUN mkdir build && cd build && qt-cmake .. -G Ninja -B . && cmake --build .

# Expose port 3000 to allow external access
EXPOSE 3000

# Command to run a simple HTTP server on port 3000 in the build directory
CMD ["sh", "-c", "cd build && python3 /opt/emsdk/upstream/emscripten/emrun.py --no_browser --port 3000 ."]

# Instructions to build the Docker image
# docker build -f qtwasmDockerfile -t tq-frontend-web .

# Instructions to run the Docker container
# docker run -it --rm -p 3000:3000 tq-frontend-web
# Comment: "Frontend service is running. Visit http://localhost:3000/apptq_frontend.html"
